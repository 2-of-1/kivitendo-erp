Aktuelle Installations- und Konfigurationshinweise: 
===================================================

gibt es:

- auf der Lx-Office Homepage unter
  http://lx-office.org/index.php?id=dokumentation

- im Lx-Office-Wiki unter Dokumentation
  http://wiki.lx-office.org/index.php/Lx-Office_ERP

- im Lx-Office-Forum:
  http://www.lx-office.org/forum/

=======================================

Lx-Office ERP
Installationsanleitung


Folgende Pakete müssen installiert sein:
========================================

Webserver (Apache)
PostgreSQL - Datenbank

Benötigte Perl-Pakete, die nicht Bestandteil einer
Standard-Perl-Installation sind:

* DBI
* DBD::Pg
* HTML::Template
* CGI::Ajax
* Class::Accessor
* Archive::Zip
* Text::Iconv
* Text::CSV_XS
* IO::Wrap (aus dem Paket IO::Stringy)
* YAML
* Template

Diese Pakete können bei den unterschiedlichen Distributionen anders
heißen.

Für Debian beötigen Sie diese Pakete:

  apache, postgresql, libdbi-perl, libdbd-pg-perl, libpgperl,
  libhtml-template-perl, libclass-accessor-perl, libarchive-zip-perl,
  libtext-iconv-perl, libyaml-perl, libtext-csv-perl,
  libio-stringy-perl, libtemplate-perl

Für Fedora Core beötigen Sie unter anderem diese Pakete:

  httpd, postgresql-server, perl-DBI, perl-DBD-Pg

Für OpenSuSE beötigen Sie diese Pakete:

  apache2, postgresql-server, perl-DBI, perl-DBD-Pg, perl-Archive-Zip,
  perl-Class-Accessor, perl-Text-Iconv, perl-Text-CSV_XS,
  perl-HTML-Template, perl-IO-stringy, perl-Template-Toolkit


Da Perl-CGI-Ajax nicht als Paket für Distributionen bereit steht, muß
es mit der CPAN-Shell installiert werden.  Leider gibt es Fälle, in
denen das nicht möglich oder praktikabel ist. LxO liefert daher das
Paket im CGI-Verzeichnis mit. Das sollte als Fall-Back greifen.


Die PostgreSQL Konfiguration muß angepasst werden.
==================================================

In der Datei postgresql.conf (/var/lib/pgsql/data/ oder
/etc/postgresql/) muß folgender Wert verändert werden:

TCPIP_SOCKET = 1 #  Nur PostgreSQL < 8.0

default_with_oids = on # Nur PostgreSQL >= 8.0


In der Datei pg_hba.conf (/var/lib/pgsql/data/ oder /etc/postgresql/)
müssen die Berichtigungen für den Zugriff geändert werden:

alte Eintragung:
----------------
local	all all	ident sameuser
host all all 127.0.0.1 255.0.0.0	ident sameuser

Änderung:
---------
local	all all	trust
host all all 127.0.0.1 255.0.0.0	trust

Besser:
-------
local   all         lxoffice                                           password
host    all         lxoffice      127.0.0.1         255.255.255.255    password


Installation des Programmpaketes
================================

Die Lx-Office ERP Installationsdatei (lxoffice-erp-2.4.x.tgz) in den
DocumentRoot des Webservers (/var/www/html/ oder /srv/www/htdocs oder
/var/www/) entpacken.

tar xvzf lxoffice-erp-2.4.x.tgz

Verändern Sie evtl. noch den Namen des Verzeichnisses

mv lxoffice-erp/ lx-erp/

oder noch besser, Sie verwenden einen Alias in der
Webserverkonfiguration.

Das Verzeichnis muß dem Webserverbenutzer (Debian: www-data, Fedora:
apache, SuSE: wwwrun) übergeben werden:

chown apache: -R lx-office-erp/


Datenbankbenutzer anlegen
=========================

Es sollte zum Zugriff auf die PostgreSQL Datenbank ein
Datenbankbenutzer angelegt werden. Führen Sie dazu folgende Befehle
nacheinander aus.

su - postgres
createuser -d lxoffice (ohne Passwort)
oder besser
createuser -d -P lxoffice (mit Passwort)

Wenn Sie später einen Datenbankzugriff konfigurieren, verändern Sie
den evtl. voreingestellten Benutzer "postgres" auf "lxoffice".


PostgreSQL - Datenbank erweitern
================================

In der Datenbank "template1" sollte bevor die restliche Konfiguration
von LxOffice ERP erfolgt noch folgende Funktion hinzugefügt werden:

su postgres
psql template1  (Zugriff über Admintool auf die Datenbank)
create function plpgsql_call_handler ()
returns opaque
as '/usr/lib/pgsql/plpgsql.so'
language 'c';

create language 'plpgsql' handler plpgsql_call_handler
lancompiler 'pl/pgsql';

!!!! Bitte beachten Sie, das der Pfad zur Datei plpgsql.so und der
Name von Distribution zu Distribution verschieden sein kann.  Bei
z.B. Debian befindet sie sich unter
'/usr/lib/postgresql/lib/plpgsql.so'.


Apache Konfiguration
====================

Der Zugriff auf das Programmverzeichnis muß in der Apache Webserver-
konfiguration httpd.conf (/etc/httpd/conf/) [bei SuSE
evtl. httpd2.conf] konfiguriert werden:

AddHandler cgi-script .pl
Alias /lx-erp/ /var/www/lx-erp/
<Directory /var/www/lx-erp>
  Options ExecCGI Includes FollowSymlinks
  DirectoryIndex login.pl			# nicht mehr unbedingt nötig, da eine index.html mitgeliefert wird
</Directory>

<Directory /var/www/lx-erp/users>
  Order Deny,Allow
  Deny from All
</Directory>

!!!Vor den einzelnen Optionen muß bei einigen Distributionen ein Plus
"+" gesetzt werden.

Auf einigen Webservern werden manchmal die Grafiken und Style-Sheets
nicht ausgeliefert. Daher die Apache-Konfig um diese Zeile erweitern:

EnableSendfile Off

Datenbank anlegen
=================

Das Administrationsmenü finden Sie unter:

http://localhost/lx-erp/admin.pl

Zuerst muß eine Datenbank angelegt werden. Anschließend ein
Benutzer. Verwenden Sie für den Datenbankzugriff den eben angelegten
Benutzer lxoffice.

Wenn Sie für die Lx-Office-Installation nicht den europäischen
Schriftsatz ISO-8859-15 sondern UTF-8 (Unicode) benutzen wollen, so
müssen Sie vor dem Anlegen der Datenbank in der Datei 'lx-erp.conf'
die Variable '$dbcharset' auf den Wert 'UTF-8' setzen. Zusätzlich muss
beim Anlegen der Datenbank 'UTF-8 Unicode' als Schriftsatz ausgewählt
werden.


OpenDocument-Vorlagen
=====================

Lx-Office unterstützt die Verwendung von Vorlagen im
OpenDocument-Format, wie es OpenOffice.org ab Version 2
erzeugt. Lx-Office kann dabei sowohl neue OpenDocument-Dokumente als
auch aus diesen direkt PDF-Dateien erzeugen.  Um die Unterstützung von
OpenDocument-Vorlagen zu aktivieren muss in der Datei "lx-erp.conf"
die Variable "$opendocument_templates" auf "1" stehen.  Dieses ist die
Standardeinstellung.

Weiterhin muss in der Datei "lx-erp.conf" die Variable "$dbcharset"
auf die Zeichenkodierung gesetzt werden, die auch bei der Speicherung
der Daten in der Datenbank verwendet wird. Diese ist in den meisten
Fällen "ISO-8859-15".

Während die Erzeugung von reinen OpenDocument-Dateien keinerlei
weitere Software benötigt, wird zur Umwandlung dieser Dateien in PDF
OpenOffice.org benötigt. Soll dieses Feature genutzt werden, so muss
neben OpenOffice.org ab Version 2 auch der "X virtual frame buffer"
(xvfb) installiert werden.  Bei Debian ist er im Paket "xvfb"
enthalten. Andere Distributionen enthalten ihn in anderen Paketen.

Nach der Installation müssen in der Datei "lx-erp.conf" zwei weitere
Variablen angepasst werden: "$openofficeorg_writer_bin" muss den
vollständigen Pfad zur OpenOffice.org Writer-Anwendung enthalten.
"$xvfb_bin" muss den Pfad zum "X virtual frame buffer" enthalten.

Zusätzlich gibt es zwei verschiedene Arten, wie Lx-Office mit
OpenOffice kommuniziert. Die erste Variante, die benutzt wird, wenn
die Variable "$openofficeorg_daemon" gesetzt ist, startet ein
OpenOffice, das auch nach der Umwandlung des Dokumentes gestartet
bleibt. Bei weiteren Umwandlungen wird dann diese laufende Instanz
benutzt. Der Vorteil ist, dass die Zeit zur Umwandlung deutlich
reduziert wird, weil nicht für jedes Dokument ein OpenOffice gestartet
werden muss. Der Nachteil ist, dass diese Methode Python und die
Python-UNO-Bindings benötigt, die Bestandteil von OpenOffice 2 sind.

Ist "$openofficeorg_daemon" nicht gesetzt, so wird für jedes Dokument
OpenOffice neu gestartet und die Konvertierung mit Hilfe eines Makros
durchgeführt. Dieses Makro muss in der Dokumentenvorlage enthalten
sein und "Standard.Conversion.ConvertSelfToPDF()" heißen. Die
Beispielvorlage templates/German-invoice.odt enthält ein solches
Makro, das in jeder anderen Dokumentenvorlage ebenfalls enthalten sein
muss.

Als letztes muss herausgefunden werden, welchen Namen OpenOffice.org
Writer dem Verzeichnis mit den Benutzereinstellungen gibt. Unter
Debian ist dies momentan "~/.openoffice.org2". Sollte der Name bei
Ihrer OpenOffice.org-Installation anders sein, so muss das Verzeichnis
"users/.openoffice.org2" entsprechend umbenannt werden. Ist der Name
z.B. einfach nur ".openoffice", so wäre folgender Befehl auszuführen:

mv users/.openoffice.org2 users/.openoffice

Dieses Verzeichnis, wie auch das komplette "users"-Verzeichnis, muss
vom Webserver beschreibbar sein. Dieses wurde in Schritt "Installation
des Programmpakets" oben bereits erledigt, kann aber erneut überprüft
werden, wenn die Konvertierung nach PDF fehlschlägt.


Lx-Office ERP verwenden
=======================

Einloggen können Sie sich unter:

http://localhost/lx-office-erp/login.pl
