[% USE HTML %][% USE LxERP %]
<table width="100%">
  <tr>
    <td>
      <table width="100%">
        <tr class="listheading">
          <th class="listheading">Shipping Address</th>
          <th class="listheading">Invoice</th>
          <th class="listheading">Order</th>
          <th class="listheading">Invdate</th>
          <th class="listheading">Description</th>
          <th class="listheading">Qty</th>
          <th class="listheading">Unit</th>
[%- IF is_customer %]
          <th class="listheading">Sell Price</th>
[%- ELSE %]
          <th class="listheading">Last Cost</th>
[%- END %]
        </tr>
[%- FOREACH row = DELIVERY %]
[%-
    row.script = is_customer ?  ( row.invoice ? 'is' : 'ar' )
                             :  ( row.invoice ? 'ir' : 'ap' )
-%]
        <tr class="listrow[% loop.count % 2 %]">
          <td>[% HTML.escape(row.shiptoname) UNLESS loop.prev.shiptoname == row.shiptoname %]&nbsp;</td>
          <td>[% IF row.id %]<a href='[% row.script %].pl?action=edit&id=[% HTML.escape(row.id) %]'>[% END %][% HTML.escape(row.invnumber)   || '&nbsp;' %][% IF row.id %]</a>[% END %]</td>
          <td>[% IF row.oe_id %]<a href='oe.pl?action=edit&type=[% IF is_customer %]sales_order[% ELSE %]purchase_order[% END %]&vc=customer&id=[% HTML.escape(row.oe_id) %]'>[% END %][% HTML.escape(row.ordnumber)   || '&nbsp;' %][% IF row.oe_id %]</a>[% END %]</td>
          <td>[% HTML.escape(row.transdate)   || '&nbsp;' %]</td>
          <td>[% HTML.escape(row.description) || '&nbsp;' %]</td>
          <td>[% HTML.escape(row.qty)         || '&nbsp;' %]</td>
          <td>[% HTML.escape(row.unit)        || '&nbsp;' %]</td>
          <td>[% LxERP.format_amount(row.sellprice, 2) || '&nbsp;' %]</td>
        </tr>
[%- END %]

     </table>
[%- IF DELIVERY.size == 15 %]
     <p>This list is capped at 15 items to keep it fast. If you need a full list, please use reports.</p>
[%- END %]
