<body <TMPL_IF NAME=onload>onload="<TMPL_VAR NAME=onload>"</TMPL_IF>>

 <form name="Form">

  <input type="hidden" name="input_name" value="<TMPL_VAR NAME=input_name ESCAPE=HTML>">
  <input type="hidden" name="input_id" value="<TMPL_VAR NAME=input_id ESCAPE=HTML>">
  <input type="hidden" name="calc_length" value="<TMPL_VAR NAME=calc_length ESCAPE=HTML>">
  <input type="hidden" name="calc_weight" value="<TMPL_VAR NAME=calc_weight ESCAPE=HTML>">
  <input type="hidden" name="row" value="<TMPL_VAR NAME=row ESCAPE=HTML>">
  <input type="hidden" name="description" value="<TMPL_VAR NAME=description ESCAPE=HTML>">

  <table width="100%">
   <tr>
    <th class="listtop"><TMPL_VAR NAME=title></th>
   </tr>
   <tr height="5"></tr>

   <tr><td>Menge und Preise unten eingeben</td></tr>

   <tr>
    <td>

     <table>
      <tr>
        <th nowrap class="listheading" colspan=2><TMPL_VAR NAME=description ESCAPE=HTML></th>
      <tr class="listheading">
        <th nowrap class="listheading">Gesamtl&auml;nge des Artikels</th>
        <th nowrap class="listheading">Gewicht pro Meter</th>
      </tr>

       <tr class="listrow_1">
        <td><TMPL_VAR NAME=length ESCAPE=HTML></td>
        <td><TMPL_VAR NAME=weight ESCAPE=HTML></td>
       </tr>
     </table>

    </td>
    </tr>
    <tr>
    <th nowrap class="listheading">Preis Alu:</th>
    <td><input id="price_alu" name="price_alu" value="<TMPL_VAR NAME=price_alu ESCAPE=HTML>"></td>
    </tr>
    <tr>
    <th nowrap class="listheading">Preis Eloxal:</th>
    <td><input id="price_eloxal" name="price_eloxal" value="<TMPL_VAR NAME=price_eloxal ESCAPE=HTML>"></td>
   </tr>
   <tr>
    <td colspan=2><hr size=3 noshade></td>
    </tr>
    <tr>
    <th nowrap class="listheading">Menge Alu:</th>
    <td><input id="qty_alu" name="qty_alu" value="<TMPL_VAR NAME=qty_alu ESCAPE=HTML>"></td>
    </tr>
    <tr>
    <th nowrap class="listheading">Menge Artikel:</th>
    <td><input id="qty_article" name="qty_article" value="<TMPL_VAR NAME=qty ESCAPE=HTML>"></td>
   </tr>  
   <tr>
    <td colspan=2><hr size=3 noshade></td>
    </tr>
    <tr>
    <th nowrap class="listheading">Gesamtpreis:</th>
    <td><input id="total" name="total"  value="<TMPL_VAR NAME=total ESCAPE=HTML>"></td>
    </tr>
    <tr>
    <th nowrap class="listheading">Gesamtpreis Alu:</th>
    <td><input id="total_alu" name="total_alu"  value="<TMPL_VAR NAME=total_alu ESCAPE=HTML>"></td>
   </tr>  
    <tr>
    <th nowrap class="listheading">Gesamtpreis Eloxal:</th>
    <td><input id="total_eloxal" name="total_eloxal"  value="<TMPL_VAR NAME=total_eloxal ESCAPE=HTML>"></td>
   </tr></table>
 <button type="button" onclick="calculate_alu()">Berechnen</button>
  <button type="button" onclick="alu_close()">Übernehmen</button>
</form>

 <script type="text/javascript">

      function calculate_alu() {
        var qty_alu = document.getElementsByName("qty_alu")[0].value.replace(/,/g, ".");
        var price_alu = document.getElementsByName("price_alu")[0].value.replace(/,/g, ".");
        var price_eloxal = document.getElementsByName("price_eloxal")[0].value.replace(/,/g, ".");
        var weight_article = document.getElementsByName("calc_weight")[0].value * document.getElementsByName("calc_length")[0].value;
        var qty_article = Math.ceil(qty_alu / weight_article);
        qty_alu = qty_article * weight_article;
        alu = qty_alu * price_alu;
        var qty_eloxal = qty_article * document.getElementsByName("calc_length")[0].value;
        eloxal = qty_eloxal * price_eloxal;
        

        total = alu + eloxal;
        alu = number_format(alu, 2, ",", ".");
        eloxal = number_format(eloxal, 2, ",", ".");
        total = number_format(total, 2, ",", ".");
        self.document.getElementsByName("qty_alu")[0].value = qty_alu;
        self.document.getElementsByName("qty_article")[0].value = qty_article;
        self.document.getElementsByName("total_alu")[0].value = alu;
        self.document.getElementsByName("total_eloxal")[0].value = eloxal;
        self.document.getElementsByName("total")[0].value = total;
      }

      function alu_close() {

        var qty_alu = document.getElementsByName("qty_alu")[0].value.replace(/,/g, ".");
        var price_alu = document.getElementsByName("price_alu")[0].value.replace(/,/g, ".");
        var price_eloxal = document.getElementsByName("price_eloxal")[0].value.replace(/,/g, ".");
        var weight_article = document.getElementsByName("calc_weight")[0].value * document.getElementsByName("calc_length")[0].value;
        var qty_article = Math.ceil(qty_alu / weight_article);
        qty_alu = qty_article * weight_article;
        alu = qty_alu * price_alu;
        var qty_eloxal = qty_article * document.getElementsByName("calc_length")[0].value;
        eloxal = qty_eloxal * price_eloxal;
        var sellprice = 


        total = alu + eloxal;
        var sellprice = total / qty_article
        qty_alu = number_format(qty_alu, 2, ",", ".");
        qty_eloxal = number_format(qty_eloxal, 2, ",", ".");
        alu = number_format(alu, 2, ",", ".");
        eloxal = number_format(eloxal, 2, ",", ".");
        sellprice = number_format(sellprice, 2, ",", ".");
        var sellprice_index = window.opener.document.getElementsByName("sellprice_" + document.getElementsByName("row")[0].value).length - 1;


        var article = document.getElementsByName("description")[0].value + "\r\nAlupreisberechnung:\r\n" + qty_alu + "kg Aluminiumprofil Einzelpreis: " + document.getElementsByName("price_alu")[0].value  +" Gesamt: " + alu + "\r\n" + qty_eloxal + "m Eloxal Einzelpreis: " + document.getElementsByName("price_eloxal")[0].value + " Gesamt: " + eloxal;
        window.opener.document.getElementsByName("qty_" + document.getElementsByName("row")[0].value)[0].value = qty_article;
        window.opener.document.getElementsByName("sellprice_" + document.getElementsByName("row")[0].value)[sellprice_index].value = sellprice;
        window.opener.document.getElementsByName("description_" + document.getElementsByName("row")[0].value)[0].value = article;
        self.close();
      }
function /*out: String*/ number_format( /* in: float   */ number, 
                                        /* in: integer */ laenge, 
                                        /* in: String  */ sep, 
                                        /* in: String  */ th_sep ) {

  number = Math.round( number * Math.pow(10, laenge) ) / Math.pow(10, laenge);
  str_number = number+"";
  arr_int = str_number.split(".");
  if(!arr_int[0]) arr_int[0] = "0";
  if(!arr_int[1]) arr_int[1] = "";
  if(arr_int[1].length < laenge){
    nachkomma = arr_int[1];
    for(i=arr_int[1].length+1; i <= laenge; i++){  nachkomma += "0";  }
    arr_int[1] = nachkomma;
  }
  if(th_sep != "" && arr_int[0].length > 3){
    Begriff = arr_int[0];
    arr_int[0] = "";
    for(j = 3; j < Begriff.length ; j+=3){
      Extrakt = Begriff.slice(Begriff.length - j, Begriff.length - j + 3);
      arr_int[0] = th_sep + Extrakt +  arr_int[0] + "";
    }
    str_first = Begriff.substr(0, (Begriff.length % 3 == 0)?3:(Begriff.length % 3));
    arr_int[0] = str_first + arr_int[0];
  }
  return arr_int[0]+sep+arr_int[1];
}
 </script>

</body>
</html>
