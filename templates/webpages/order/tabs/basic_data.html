[% USE T8 %]
[% USE HTML %]
[% USE LxERP %]
[% USE L %]
[% USE P %]

[% INCLUDE 'generic/set_longdescription.html' %]

<div id="ui-tabs-basic-data">
<div class="wrapper">

  <table class="tbl-horizontal col">
    <caption>[% 'Customer & Order info' | $T8 %]</caption>
    <tbody>
      <tr>
        <th>[% SELF.cv | $T8 %]</th>
        [% SET cv_id = SELF.cv _ '_id' %]
        <td>
          [% P.customer_vendor.picker("order.${SELF.cv}" _ '_id', SELF.order.$cv_id, type=SELF.cv, style='width: 300px') %]
          [% P.button_tag("kivi.Order.show_vc_details_dialog()", LxERP.t8("Details (one letter abbreviation)")) %]
        </td>
      </tr>
      <tr id='cp_row' [% IF !SELF.order.${SELF.cv}.contacts.size %]style='display:none'[% END %]>
        <th>[% 'Contact Person' | $T8 %]</th>
        <td>[% L.select_tag('order.cp_id',
                            SELF.order.${SELF.cv}.contacts,
                            default=SELF.order.cp_id,
                            title_key='full_name_dep',
                            value_key='cp_id',
                            with_empty=1,
                            style='width: 300px') %]</td>
      </tr>
      <tr id='shipto_row' [% IF !SELF.order.${SELF.cv}.shipto.size %]style='display:none'[% END %]>
        <th>[% 'Shipping Address' | $T8 %]</th>
        <td>[% L.select_tag('order.shipto_id',
                            SELF.order.${SELF.cv}.shipto,
                            default=SELF.order.shipto_id,
                            title_key='displayable_id',
                            value_key='shipto_id',
                            with_empty=1,
                            style='width: 300px') %]</td>
      </tr>
      [% PROCESS order/tabs/_business_info_row.html SELF=SELF %]
      <tr>
        <th>[% 'Steuersatz' | $T8 %]</th>
        <td>[% L.select_tag('order.taxzone_id', SELF.all_taxzones, default=SELF.order.taxzone_id, title_key='description', style='width: 300px', class='recalc') %]</td>
      </tr>
      [% IF SELF.all_departments.size %]
        <tr>
          <th>[% 'Department' | $T8 %]</th>
          <td>
            [% L.select_tag('order.department_id', SELF.all_departments, default=SELF.order.department_id, title_key='description', with_empty=1, style='width:300px') %]
          </td>
        </tr>
      [% END %]
      <tr>
        <th>[% 'Shipping Point' | $T8 %]</th>
        <td>[% L.input_tag('order.shippingpoint', SELF.order.shippingpoint, style='width: 300px') %]</td>
      </tr>
      <tr>
        <th>[% 'Ship via' | $T8 %]</th>
        <td>[% L.input_tag('order.shipvia', SELF.order.shipvia, style='width: 300px') %]</td>
      </tr>
      <tr>
        <th>[% 'Transaction description' | $T8 %]</th>
        <td>[% L.input_tag('order.transaction_description', SELF.order.transaction_description, style='width: 300px') %]</td>
      </tr>
      <tr>
        <th>[% 'Project Number' | $T8 %]</th>
        <td>[% P.project.picker('order.globalproject_id', SELF.order.globalproject_id, style='width: 300px') %]</td>
      </tr>
    </tbody>
  </table>

  <table class="tbl-horizontal col">
    <caption>[% 'Notes' | $T8 %]</caption>
    <tbody>
      <tr>
        <th>[% 'Notes' | $T8 %]</th>
        <td>[% L.textarea_tag('order.notes', SELF.order.notes, wrap="soft", style="width: 350px; height: 150px", class="texteditor") %]</td>
      </tr>
      <tr>
        <th>[% 'Internal Notes' | $T8 %]</th>
        <td>[% L.textarea_tag('order.intnotes', SELF.order.intnotes, wrap="soft", style="width: 350px; height: 150px") %]</td>
      </tr>
    </tbody>
  </table>


  <table class="tbl-horizontal col">
    <caption>[% 'Handling, Dates & Numbers' | $T8 %]</caption>
    <tbody>
      <tr>
        <td colspan="2">
          [% IF SELF.order.id %]
            <label for="order.delivered">[% 'Delivery Order(s) for full qty created' | $T8 %]</label>
            [% L.yes_no_tag('order.delivered', SELF.order.delivered) %]
            <label for="order.closed">[% 'Closed' | $T8 %]</label>
            [% L.yes_no_tag('order.closed', SELF.order.closed) %]
          [% END %]
        </td>
      </tr>
      <tr>
        <th>[% 'Employee' | $T8 %]</th>
        <td>[% L.select_tag('order.employee_id',
          SELF.all_employees,
          default=(SELF.order.employee_id ? SELF.order.employee_id : SELF.current_employee_id),
          title_key='safe_name') %]</td>
      </tr>
      [% IF SELF.cv == 'customer' %]
        <tr>
          <th>[% 'Salesman' | $T8 %]</th>
          <td>[% L.select_tag('order.salesman_id',
            SELF.all_salesmen,
            default=(SELF.order.salesman_id ? SELF.order.salesman_id : SELF.current_employee_id),
            title_key='safe_name') %]</td>
        </tr>
      [% END %]
      [% IF (SELF.type == "sales_order" || SELF.type == "purchase_order") %]
        <tr>
          <th>[% 'Order Number' | $T8 %]</th>
          <td>[% L.input_tag('order.ordnumber', SELF.order.ordnumber, size = 11, onchange='kivi.Order.set_number_in_title(this)') %]</td>
        </tr>
      [% END %]
      [% IF (SELF.type == "sales_order" || SELF.type == "sales_quotation") %]
        [% SET quo_nr_txt = 'Quotation Number' %]
      [% ELSE %]
        [% SET quo_nr_txt = 'RFQ Number' %]
      [% END %]
      <tr>
        <th>[% quo_nr_txt | $T8 %]</th>
        [% IF (SELF.type == "sales_order" || SELF.type == "purchase_order") %]
          <td>[% L.input_tag('order.quonumber', SELF.order.quonumber, size = 11) %]</td>
        [% ELSE %]
          <td>[% L.input_tag('order.quonumber', SELF.order.quonumber, size = 11, onchange='kivi.Order.set_number_in_title(this)') %]</td>
        [% END %]
      </tr>
      [% IF (SELF.type == "sales_order" || SELF.type == "purchase_order") %]
        <tr>
          <th>[% 'Customer Order Number' | $T8 %]</th>
          <td>[% L.input_tag('order.cusordnumber', SELF.order.cusordnumber, size = 11) %]</td>
        </tr>
      [% END %]
      [% IF (SELF.type == "sales_order" || SELF.type == "purchase_order") %]
        [% SET transdate_txt = 'Order Date' %]
      [% ELSIF SELF.type == "sales_quotation" %]
        [% SET transdate_txt = 'Quotation Date' %]
      [% ELSE %]
        [% SET transdate_txt = 'RFQ Date' %]
      [% END %]
      <tr>
        <th>[% transdate_txt | $T8 %]</th>
        <td>[% L.date_tag('order.transdate', SELF.order.transdate) %]</td>
      </tr>
      [% IF (SELF.type == "sales_order" || SELF.type == "purchase_order") %]
        [% SET reqdate_txt = 'Reqdate' %]
      [% ELSIF SELF.type == "sales_quotation" %]
        [% SET reqdate_txt = 'Valid until' %]
      [% ELSE %]
        [% SET reqdate_txt = 'Required by' %]
      [% END %]
      <tr>
        <th>[% reqdate_txt | $T8 %]</th>
        <td>[% L.date_tag('order.reqdate', SELF.order.reqdate) %]</td>
      </tr>
      [% IF SELF.type == "sales_quotation" %]
        <tr>
          <th>[% 'Order probability' | $T8 %]</th>
          <td>[% L.select_tag('order.order_probability', SELF.order_probabilities, title='title', default=SELF.order.order_probability) %]%</td>
        </tr>
        <tr>
          <th>[% 'Expected billing date' | $T8 %]</th>
          <td>[% L.date_tag('order.expected_billing_date', SELF.order.expected_billing_date) %]</td>
        </tr>
      [% END %]
      <tr>
        <th>[% 'Insert Date' | $T8 %]</th>
        <td>[% SELF.order.itime_as_date %]</td>
      </tr>
    </tbody>
  </table>

</div><!-- /.wrapper -->

  [% PROCESS order/tabs/_item_input.html %]

  [% L.button_tag('kivi.Order.show_multi_items_dialog()', LxERP.t8('Add multiple items')) %]


  <div id="row_table_scroll_id" style="overflow-y: auto; height: 25vh">
    <table id="row_table_id">
      <thead>
        <tr>
          <th style='text-align:center'>
            [% IF MYCONFIG.show_form_details %]
              [% L.img_tag(src="image/collapse.svg", alt=LxERP.t8('Hide all details'), title=LxERP.t8('Hide all details'), id='expand_all', "data-expanded"="1") %]
            [% ELSE %]
              [% L.img_tag(src="image/expand.svg", alt=LxERP.t8('Show all details'), title=LxERP.t8('Show all details'), id='expand_all') %]
            [% END %]
          </th>
          <th>[% 'position'     | $T8 %] </th>
          <th style='text-align:center'><img src="image/updown.png" alt="[% LxERP.t8('reorder item') %]"></th>
          <th style='text-align:center'><img src="image/close.png" alt="[% LxERP.t8('delete item') %]"></th>
          <th id="partnumber_header_id"><a href='#' onClick='javascript:kivi.Order.reorder_items("partnumber")'> [% 'Partnumber'  | $T8 %]</a></th>
          <th id="partclass_header_id">[% 'Type'  | $T8 %]</th>
          <th id="description_header_id"><a href='#' onClick='javascript:kivi.Order.reorder_items("description")'>[% 'Description' | $T8 %]</a></th>
          <th id="qty_header_id"><a href='#' onClick='javascript:kivi.Order.reorder_items("qty")'>        [% 'Qty'         | $T8 %]</a></th>
          <th >[% 'Price Factor' | $T8 %]</th>
          <th >[% 'Unit'         | $T8 %]</th>
          <th >[% 'Price Source' | $T8 %]</th>
          <th id="sellprice_header_id"><a href='#' onClick='javascript:kivi.Order.reorder_items("sellprice")'> [% 'Price'       | $T8 %]</a></th>
          <th id="discount_header_id" ><a href='#' onClick='javascript:kivi.Order.reorder_items("discount")'>  [% 'Discount'    | $T8 %]</a></th>
          <th>[% 'Extended'     | $T8 %]</th>
        </tr>
      </thead>
      [% FOREACH item = SELF.order.items_sorted %]
        [% PROCESS order/tabs/_row.html ITEM=item ID=(item.id||item.new_fake_id) TYPE=SELF.type ALL_PRICE_FACTORS=SELF.all_price_factors %]
      [% END %]
    </table>
  </div><!-- /#row_table_scroll_id -->


 
  
  
  <table class="tbl-horizontal col">
    <caption>[% 'Terms' | $T8 %]</caption>
    <tbody>
      <tr>
        <th>[% 'Payment Terms' | $T8 %]</th>
        <td>[% L.select_tag('order.payment_id',
                            SELF.all_payment_terms,
                            default = SELF.order.payment_id,
                            with_empty = 1,
                            title_key = 'description',
                            style = 'width: 250px') %]</td>
      </tr>
      <tr>
        <th>[% 'Delivery Terms' | $T8 %]</th>
        <td>[% L.select_tag('order.delivery_term_id',
                            SELF.all_delivery_terms,
                            default = SELF.order.delivery_term_id,
                            with_empty = 1,
                            title_key = 'description',
                            style = 'width: 250px') %]</td>
      </tr>
      [% IF SELF.type == "sales_order" %]
        <tr>
          <th>[% 'Periodic Invoices' | $T8 %]</th>
          <td>
            [% L.button_tag('kivi.Order.show_periodic_invoices_config_dialog()', LxERP.t8('Configure')) %]
            (<span id='periodic_invoices_status'>[% SELF.periodic_invoices_status %]</span>)
            <a href="doc/html/ch03.html#features.periodic-invoices.variables" target="_blank" class="button wi-tiny neutral">?</a>
          </td>
        </tr>
      [% END %]
    </tbody>
  </table>
  
  
  <table class="tbl-horizontal col">
    <tbody>
      <tr id="taxincluded_row_id" [% IF !SELF.taxes.size %]style="display:none"[% END %]>
        <td colspan="2">
          <label for="order.taxincluded"><b>[% 'Tax Included' | $T8 %]</b></label>
          [% L.yes_no_tag('order.taxincluded', SELF.order.taxincluded, class='recalc') %]
        </td>
      </tr>
      <tr id="subtotal_row_id" [% IF SELF.order.taxincluded %]style="display:none"[% END %]>
        <th>[% 'Subtotal' | $T8 %]</th>
        <td>[% L.div_tag(SELF.order.netamount_as_number, id='netamount_id') %]</td>
      </tr>
      [% FOREACH tax = SELF.taxes %]
        [% PROCESS order/tabs/_tax_row.html TAX=tax TAXINCLUDED=SELF.order.taxincluded %]
      [% END %]
      <tr id="amount_row_id">
        <th>[% 'Total' | $T8 %]</th>
        <td>[% L.div_tag(SELF.order.amount_as_number, id='amount_id') %]</td>
      </tr>
    </tbody>
  </table>


</div><!-- /#ui-tabs-basic-data -->

[% L.sortable_element('#row_table_id') %]
