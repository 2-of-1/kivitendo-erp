[%- USE HTML %]
[%- USE L %]
[%- USE LxERP %]
[%- USE T8 %]

<h1>[% 'Part picker' | $T8 %]</h1>
<div style='overflow:hidden'>

[% L.input_tag('part_picker_filter', SELF.filter.all_substr__ilike, class='part_picker_filter') %]
[% L.hidden_tag('part_picker_real_id', FORM.real_id) %]

<div style='clear:both'></div>
<div id='part_picker_result'></div>
</div>

<script type='text/javascript'>
  var timer;
  var update_results = function(){
    var $type   = $('#[% FORM.real_id %]_type');
    var $column = $('#[% FORM.real_id %]_column');
    $.ajax({
      url: 'controller.pl?action=Part/part_picker_result',
      data: {
        'filter.all:substr::ilike': function(){ var val = $('#part_picker_filter').val(); return val === undefined ? '' : val },
        'filter.type': function(){ return $type.val() },
        'column': function(){ return $column.val() },
        'real_id': [% FORM.real_id.json %],
      },
      success: function(data){ $('#part_picker_result').html(data) }
    });
  };
  $(function(){
    $('#part_picker_filter').focus();
    update_results();
  });
  $('#part_picker_filter').keypress(function (event){
    window.clearTimeout(timer);
    timer = window.setTimeout(update_results, 100);
  });
</script>
